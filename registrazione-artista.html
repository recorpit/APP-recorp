<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrazione Artista - RECORP ALL-IN-ONE</title>
    <link rel="stylesheet" href="./assets/style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="./index.html" class="logo">
                <img src="./assets/logo.png" alt="RECORP Logo">
                <span class="logo-text">RECORP ALL-IN-ONE</span>
            </a>
            
            <!-- üÜï Indicatore sorgente agibilit√† -->
            <div class="source-indicator" id="sourceIndicator" style="display: none;">
                <span class="source-badge">
                    <i class="fas fa-theater-masks"></i> Da Agibilit√†
                </span>
            </div>
        </div>
    </nav>

    <div class="page-container">
        <div class="container">
            <div class="registration-container">
                <div class="header text-center">
                    <h1 class="page-title" id="pageTitle">Gestione Artisti</h1>
                    <p class="page-subtitle" id="pageSubtitle">Scegli un'azione da eseguire</p>
                    
                    <!-- üÜï Breadcrumb per agibilit√† -->
                    <div class="agibilita-breadcrumb" id="agibilitaBreadcrumb" style="display: none;">
                        <nav class="breadcrumb">
                            <span class="breadcrumb-item">
                                <i class="fas fa-theater-masks"></i> Sistema Agibilit√†
                            </span>
                            <span class="breadcrumb-separator">‚Ä∫</span>
                            <span class="breadcrumb-item active">
                                <i class="fas fa-user-plus"></i> Registrazione Completa Artista
                            </span>
                        </nav>
                    </div>
                </div>
                
                <div class="loading-indicator" id="loadingIndicator">
                    <span class="loading-icon spinning">‚åõ</span> Caricamento database localit√†...
                </div>
                
                <!-- üÜï Alert di successo migliorato -->
                <div class="alert alert-success" id="successMessage">
                    <i class="fas fa-check-circle"></i>
                    <span id="successText">Artista registrato con successo!</span>
                    <div class="success-actions" id="successActions" style="display: none;">
                        <button class="btn btn-sm btn-outline-success" id="addToAgibilitaBtn">
                            <i class="fas fa-plus"></i> Aggiungi ad Agibilit√†
                        </button>
                        <button class="btn btn-sm btn-outline-primary" id="backToAgibilitaBtn">
                            <i class="fas fa-arrow-left"></i> Torna ad Agibilit√†
                        </button>
                    </div>
                </div>
                
                <div class="alert alert-error" id="errorMessage">
                    Errore durante la registrazione. Riprova.
                </div>
                
                <!-- üÜï Info prefill da agibilit√† -->
                <div class="alert alert-info" id="prefillInfo" style="display: none;">
                    <i class="fas fa-info-circle"></i>
                    <strong>Dati precompilati:</strong> Alcuni campi sono stati compilati automaticamente dal sistema agibilit√†.
                    <button class="btn btn-sm btn-outline-info" id="clearPrefillBtn">
                        <i class="fas fa-eraser"></i> Cancella Precompilazione
                    </button>
                </div>
                
                <!-- Selezione modalit√† -->
                <div class="mode-selection" id="modeSelection">
                    <div class="mode-cards">
                        <div class="mode-card" id="newModeCard">
                            <div class="mode-icon">‚ûï</div>
                            <h3>Nuovo Artista</h3>
                            <p>Registra un nuovo artista nel database</p>
                        </div>
                        <div class="mode-card" id="editModeCard">
                            <div class="mode-icon">‚úèÔ∏è</div>
                            <h3>Modifica Artista</h3>
                            <p>Modifica i dati di un artista esistente</p>
                        </div>
                    </div>
                </div>
                
                <!-- Selezione artista per modifica -->
                <div class="artist-selection d-none" id="artistSelection">
                    <div class="search-container">
                        <input type="text" 
                               class="form-control search-input" 
                               id="searchArtistInput" 
                               placeholder="Cerca per nome, cognome o codice fiscale...">
                    </div>
                    <div class="artists-list" id="artistsListContainer">
                        <!-- Popolato dinamicamente -->
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="backToModeBtn">
                            <span class="btn-icon">‚¨ÖÔ∏è</span> Indietro
                        </button>
                    </div>
                </div>
                
                <!-- Form registrazione/modifica -->
                <form class="registration-form d-none" id="registrationForm">
                    <!-- Sezione Dati Anagrafici -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">Dati Anagrafici</h2>
                            <p class="section-subtitle">Informazioni personali dell'artista</p>
                        </div>
                        
                        <div class="form-content">
                            <div class="form-group highlight-group">
                                <label class="form-label" for="codiceFiscale">
                                    Codice Fiscale <span class="required">*</span>
                                </label>
                                <input type="text" 
                                       class="form-control uppercase-field" 
                                       id="codiceFiscale" 
                                       name="codiceFiscale" 
                                       maxlength="16" 
                                       required 
                                       placeholder="RSSMRA85T10A562S">
                                <small class="form-text">Il codice fiscale deve essere inserito per primo - la data di nascita verr√† compilata automaticamente</small>
                                <div class="cf-alternative-notice d-none" id="cfAlternativeNotice">
                                    <small class="text-info">
                                        <strong>‚ÑπÔ∏è Nota:</strong> Per artisti stranieri senza codice fiscale, il sistema generer√† un identificativo temporaneo
                                    </small>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="nomeArte">
                                    Nome d'Arte
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       id="nomeArte" 
                                       name="nomeArte" 
                                       placeholder="Opzionale">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="nome">
                                        Nome <span class="required">*</span>
                                    </label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="nome" 
                                           name="nome" 
                                           required 
                                           placeholder="Mario">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="cognome">
                                        Cognome <span class="required">*</span>
                                    </label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="cognome" 
                                           name="cognome" 
                                           required 
                                           placeholder="Rossi">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="dataNascita">
                                        Data di Nascita <span class="required">*</span>
                                    </label>
                                    <input type="date" 
                                           class="form-control" 
                                           id="dataNascita" 
                                           name="dataNascita" 
                                           required>
                                    <small class="form-text">Compilata automaticamente dal codice fiscale - modificabile se necessario</small>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="sesso">
                                        Sesso
                                    </label>
                                    <select class="form-control" id="sesso" name="sesso">
                                        <option value="">Seleziona...</option>
                                        <option value="M">Maschio</option>
                                        <option value="F">Femmina</option>
                                    </select>
                                    <small class="form-text">Estratto automaticamente dal codice fiscale</small>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="luogoNascita">
                                        Luogo di Nascita
                                    </label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="luogoNascita" 
                                           name="luogoNascita" 
                                           placeholder="Comune o stato estero">
                                    <small class="form-text">Estratto automaticamente dal codice fiscale quando possibile</small>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="provinciaNascita">
                                        Provincia di Nascita
                                    </label>
                                    <input type="text" 
                                           class="form-control uppercase-field" 
                                           id="provinciaNascita" 
                                           name="provinciaNascita" 
                                           maxlength="2"
                                           placeholder="XX">
                                    <small class="form-text">Sigla provincia (se nato in Italia)</small>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="matricolaENPALS">
                                        Matricola ENPALS
                                    </label>
                                    <input type="text" 
                                           class="form-control uppercase-field" 
                                           id="matricolaENPALS" 
                                           name="matricolaENPALS" 
                                           placeholder="123456">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="nazionalita">
                                        Nazionalit√† <span class="required">*</span>
                                    </label>
                                    <select class="form-control" id="nazionalita" name="nazionalita" required>
                                        <option value="">Seleziona nazionalit√†...</option>
                                        <option value="IT" selected>Italiana</option>
                                        <option value="EU">Comunitaria (UE)</option>
                                        <option value="EX">Extracomunitaria</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="telefono">
                                        Telefono
                                    </label>
                                    <input type="tel" 
                                           class="form-control" 
                                           id="telefono" 
                                           name="telefono" 
                                           placeholder="+39 333 1234567">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="email">
                                        Email
                                    </label>
                                    <input type="email" 
                                           class="form-control" 
                                           id="email" 
                                           name="email" 
                                           placeholder="artista@esempio.it">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sezione Indirizzo -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">Indirizzo di Residenza</h2>
                            <p class="section-subtitle">Dati relativi alla residenza dell'artista</p>
                        </div>
                        
                        <div class="form-content">
                            <div class="form-group">
                                <label class="form-label" for="indirizzo">
                                    Indirizzo <span class="required">*</span>
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       id="indirizzo" 
                                       name="indirizzo" 
                                       required 
                                       placeholder="Via Roma, 123">
                                <small class="form-text">Per artisti stranieri, inserire l'indirizzo completo inclusa la citt√†</small>
                            </div>
                            
                            <!-- Campo Paese per stranieri -->
                            <div class="form-group d-none" id="paeseResidenzaGroup">
                                <label class="form-label" for="paeseResidenza">
                                    Paese di Residenza <span class="required">*</span>
                                </label>
                                <select class="form-control" id="paeseResidenza" name="paeseResidenza">
                                    <option value="">Seleziona paese...</option>
                                </select>
                                <small class="form-text">Seleziona il paese di residenza per artisti stranieri</small>
                            </div>
                            
                            <!-- Avviso per stranieri -->
                            <div class="foreign-address-notice d-none" id="foreignAddressNotice">
                                <div class="alert alert-info">
                                    <strong>üìç Artista Straniero:</strong> Per gli artisti stranieri non √® necessario compilare provincia, comune e CAP italiani. L'indirizzo completo (via, numero, CAP e citt√†) va inserito nel campo indirizzo sopra.
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="provincia">
                                        Provincia <span class="required">*</span>
                                    </label>
                                    <select class="form-control" id="provincia" name="provincia" required>
                                        <option value="">Seleziona provincia...</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="citta">
                                        Citt√† <span class="required">*</span>
                                    </label>
                                    <select class="form-control" id="citta" name="citta" required disabled>
                                        <option value="">Prima seleziona la provincia</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="cap">
                                        CAP <span class="required">*</span>
                                    </label>
                                    <select class="form-control" id="cap" name="cap" required disabled>
                                        <option value="">Prima seleziona la citt√†</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sezione Dati Professionali -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">Dati Professionali</h2>
                            <p class="section-subtitle">Informazioni relative all'attivit√† artistica</p>
                        </div>
                        
                        <div class="form-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="mansione">
                                        Mansione <span class="required">*</span>
                                    </label>
                                    <select class="form-control" id="mansione" name="mansione" required>
                                        <option value="">Seleziona mansione...</option>
                                        <option value="DJ">DJ (032)</option>
                                        <option value="Vocalist">Vocalist (031)</option>
                                        <option value="Musicista">Musicista (030)</option>
                                        <option value="Cantante">Cantante (033)</option>
                                        <option value="Ballerino/a">Ballerino/a (092)</option>
                                        <option value="Performer">Performer (090)</option>
                                        <option value="Animatore">Animatore (091)</option>
                                        <option value="Tecnico Audio">Tecnico Audio (117)</option>
                                        <option value="Tecnico Luci">Tecnico Luci (118)</option>
                                        <option value="Fotografo">Fotografo (126)</option>
                                        <option value="Videomaker">Videomaker (127)</option>
                                        <option value="Truccatore">Truccatore (141)</option>
                                        <option value="Costumista">Costumista (142)</option>
                                        <option value="Scenografo">Scenografo (150)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="hasPartitaIva">
                                        Ha Partita IVA? <span class="required">*</span>
                                    </label>
                                    <select class="form-control" id="hasPartitaIva" name="hasPartitaIva" required>
                                        <option value="">Seleziona...</option>
                                        <option value="no">No</option>
                                        <option value="si">S√¨</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group d-none" id="partitaIvaGroup">
                                <label class="form-label" for="partitaIva">
                                    Partita IVA <span class="required">*</span>
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       id="partitaIva" 
                                       name="partitaIva" 
                                       maxlength="11" 
                                       pattern="[0-9]{11}" 
                                       placeholder="12345678901">
                                <small class="form-text">Inserire 11 cifre della partita IVA</small>
                            </div>
                            
                            <div class="form-group d-none" id="tipoRapportoGroup">
                                <label class="form-label" for="tipoRapporto">
                                    Tipologia Rapporto di Lavoro <span class="required">*</span>
                                </label>
                                <select class="form-control" id="tipoRapporto" name="tipoRapporto">
                                    <option value="occasionale" selected>Prestazione Occasionale</option>
                                    <option value="chiamata">Contratto a Chiamata</option>
                                    <option value="fulltime">Full Time</option>
                                </select>
                                <small class="form-text">Tipo di contratto per chi non ha partita IVA</small>
                            </div>
                            
                            <div class="form-group d-none" id="codiceComunicazioneGroup">
                                <label class="form-label" for="codiceComunicazione">
                                    Codice Comunicazione INPS <span class="required">*</span>
                                </label>
                                <input type="text" 
                                       class="form-control uppercase-field" 
                                       id="codiceComunicazione" 
                                       name="codiceComunicazione" 
                                       placeholder="XXXXXXXXXX">
                                <small class="form-text">Codice comunicazione obbligatorio per contratti a chiamata</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="iban">
                                    IBAN <span class="required">*</span>
                                </label>
                                <input type="text" 
                                       class="form-control uppercase-field" 
                                       id="iban" 
                                       name="iban" 
                                       maxlength="34" 
                                       required
                                       placeholder="IT60X0542811101000000123456">
                                <small class="form-text">IBAN per i pagamenti (27 caratteri per Italia)</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="note">
                                    Note
                                </label>
                                <textarea class="form-control" 
                                          id="note" 
                                          name="note" 
                                          rows="3" 
                                          placeholder="Informazioni aggiuntive sull'artista..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Azioni Form -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <span class="btn-icon">üíæ</span> <span id="submitText">Registra Artista</span>
                        </button>
                        <button type="button" class="btn btn-secondary btn-lg" id="cancelBtn">
                            <span class="btn-icon">‚ùå</span> Annulla
                        </button>
                        
                        <!-- üÜï Pulsante ritorno agibilit√† -->
                        <button type="button" class="btn btn-outline-info btn-lg" id="backToAgibilitaFormBtn" style="display: none;">
                            <span class="btn-icon">üé≠</span> Torna ad Agibilit√† senza Salvare
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Include Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Include Database GI Loader -->
    <script src="./comuni-loader.js"></script>
    <!-- Include Supabase Config -->
    <script type="module" src="./supabase-config.js"></script>
    <!-- Include Registration Scripts -->
    <script type="module" src="./registrazione-artista.js"></script>
</body>
</html>